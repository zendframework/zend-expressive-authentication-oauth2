<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="OAuth2 (server) for Expressive and PSR-7 applications.">  
    <link rel="canonical" href="https://docs.zendframework.com/v1/intro/">
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>Introduction - zend-expressive-authentication-oauth2 - Zend Framework Docs</title>

    <link rel="stylesheet" href="/css/styles.css">
</head>
<body id="page-top">

    
    <div class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">

            
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-tooltip data-placement="bottom" title="Go to the ZF homepage">
                    <img src="../../img/zend-framework-logo.svg" height="28" alt="Zend Framework">
                </a>
            </span>
        </div>

        <div class="navbar-collapse collapse">

            
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="https://framework.zend.com/about">About</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/downloads">Install</a>
                </li>
                <li class="active">
                    <a href="https://docs.zendframework.com">Documentation</a>
                </li>
                <li>
                    <a href="https://www.zend.com/en/services/training">Training</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/blog">Blog</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/participate">Participate</a>
                </li>
            </ul>

            
            
                <div class="nav navbar-nav navbar-collapse visible-xs-block ">
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../..">zend-expressive-authentication-oauth2</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item subnavigation__list-item--active">
                                <a href="./" class="subnavigation__link">Introduction</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../usage/" class="subnavigation__link">Usage</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../authorization-server/" class="subnavigation__link">Authorization server</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../authenticated-user/" class="subnavigation__link">Authenticated user</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item">
                                <span class="subnavigation__headline">Grant</span>
                                <ul class="subnavigation__list">
                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../grant/client_credentials/" class="subnavigation__link">Client credentials</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../grant/password/" class="subnavigation__link">Password</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../grant/auth_code/" class="subnavigation__link">Authorization code</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../grant/implicit/" class="subnavigation__link">Implicit</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../grant/refresh_token/" class="subnavigation__link">Refresh token</a>
    </li>

                                    
                                </ul>
                            </li>
                        
                    
                
            
        </ul>
    </div>

                </div>
            

            
            <div class="nav navbar-nav navbar-collapse visible-xs-block">
                <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</div>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-xs-8">
                <h1 class="header__title">
                    Documentation

                    
                        <small class="header__subtitle">zend-expressive-authentication-oauth2</small>
                    
                </h1>
            </div>

            
            <div class="col-xs-4 text-right">
                
                    

                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/zendframework/zend-expressive-authentication-oauth2/" class="header__link header__link--github" title="Go to repository of zend-expressive-authentication-oauth2">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="laminas-announcement">
    <div class="container">
        <div class="row">
            <div class="col-xs-12"><strong>
                This package has moved. Visit its replacement, <a href="https://docs.mezzio.dev/mezzio-authentication-oauth2/">mezzio/mezzio-authentication-oauth2.</a>
            </strong></div>
        </div>
    </div>
</div>

    
    <div class="container">
        <div class="row">
            <div class="col-md-9 col-xs-12 content" role="main">
            <!-- content:begin -->
                
                    <ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
    <li><a href="https://framework.zend.com/">Home</a></li>

    
        <li><a href="https://docs.zendframework.com/">Documentation</a></li>

        
            <li><a href="../..">zend-expressive-authentication-oauth2</a></li>

            

            <li class="active">Introduction</li>
        
    
</ol>






    
    

    <div>
        
    

    
    
        <div class="toc">
            <h6 class="toc__headline">In This Article</h6>
            <ul class="toc__list">
                
                    <li class="toc__entry">
                        <a href="#installation" class="toc__link">Installation</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#configuration" class="toc__link">Configuration</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#oauth2-database" class="toc__link">OAuth2 Database</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#configure-oauth2-routes" class="toc__link">Configure OAuth2 Routes</a>
                    </li>
                
            </ul>
        </div>
    

    </div>

    <h1 id="zendframeworkzend-expressive-authentication-oauth2">zendframework/zend-expressive-authentication-oauth2</h1>
<p>This component provides <a href="https://oauth.net/2/">OAuth2</a> (server) authentication
for <a href="https://docs.zendframework.com/zend-expressive/">Expressive</a> and
<a href="https://www.php-fig.org/psr/psr-7/">PSR-7</a>/<a href="https://www.php-fig.org/psr/psr-15/">PSR-15</a>
applications. It implements <code>Zend\Expressive\Authentication\AuthenticationInterface</code>,
and it can be used as an adapter for <a href="https://github.com/zendframework/zend-expressive-authentication">zend-expressive-authentication</a>.</p>
<p>This library uses the <a href="https://oauth2.thephpleague.com/">league/oauth2-server</a>
package for implementing the OAuth2 server.</p>
<p>If you need an introduction to OAuth2, you can read the following references:</p>
<ul>
<li><a href="https://apigility.org/documentation/auth/authentication-oauth2">OAuth2 documentation</a>
  from the Apigility project.</li>
<li><a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-oauth-2">An Introduction to OAuth 2</a>
  by DigitalOcean.</li>
<li>The <a href="https://oauth.net/2/">OAuth2 specification</a> itself, via its official
  website.</li>
</ul>
<h2 id="installation">Installation</h2>
<p>In order to implement the OAuth2 server, we first need to configure it. The
first step is to generate new cryptographic keys. We need to execute the script
<code>./vendor/bin/generate-oauth2-keys</code> in order to generate these keys.</p>
<pre><code class="language-bash">$ ./vendor/bin/generate-oauth2-keys
</code></pre>

<p>This script will store the keys in the application's <code>data</code> folder if found:</p>
<pre><code class="language-text">Private key stored in:
./data/oauth/private.key
Public key stored in:
./data/oauth/public.key
Encryption key stored in:
./data/oauth/encryption.key
</code></pre>

<p>The script will generate public and private keys, and an encryption key.
These keys are used by <a href="https://oauth2.thephpleague.com/">league/oauth2-server</a>
as security settings for the OAuth2 server infrastructure.</p>
<h2 id="configuration">Configuration</h2>
<p>The OAuth2 server is configured by the <code>authentication</code> configuration key in the
PSR-11 container (e.g. <a href="https://github.com/zendframework/zend-servicemanager">zend-servicemanager</a>).</p>
<p>The default values are:</p>
<pre><code class="language-php">use League\OAuth2\Server\Grant;

return [
    'private_key'    =&gt; __DIR__ . '/../data/oauth/private.key',
    'public_key'     =&gt; __DIR__ . '/../data/oauth/public.key',
    'encryption_key' =&gt; require __DIR__ . '/../data/oauth/encryption.key',
    'access_token_expire'  =&gt; 'P1D',
    'refresh_token_expire' =&gt; 'P1M',
    'auth_code_expire'     =&gt; 'PT10M',
    'pdo' =&gt; [
        'dsn'      =&gt; '',
        'username' =&gt; '',
        'password' =&gt; ''
    ],

    // Set value to null to disable a grant
    'grants' =&gt; [
        Grant\ClientCredentialsGrant::class =&gt; Grant\ClientCredentialsGrant::class,
        Grant\PasswordGrant::class          =&gt; Grant\PasswordGrant::class,
        Grant\AuthCodeGrant::class          =&gt; Grant\AuthCodeGrant::class,
        Grant\ImplicitGrant::class          =&gt; Grant\ImplicitGrant::class,
        Grant\RefreshTokenGrant::class      =&gt; Grant\RefreshTokenGrant::class
    ],
];
</code></pre>

<p>The <code>private_key</code> and <code>public_key</code> values contains the paths to the previous
generated pair of keys. The <code>encryption_key</code> contains the encryption key value
as a string, as stored in the <code>data/oauth/encryption.key</code> file.</p>
<p>By default both key files are checked for correct permissions (chmod 400, 440,
600, 640 or 660 is expected, and 600 or 660 is recommended). In case the
environment/operating system (e.g. Windows) does not support such a permissions,
the check can be disabled:</p>
<pre><code class="language-php">    // ...
    'private_key' =&gt; [
        'key_or_path' =&gt; __DIR__ . '/../data/oauth/private.key',
        'key_permissions_check' =&gt; false,
    ],
    // ...
</code></pre>

<p>The <code>access_token_expire</code> value is the time-to-live (TTL) value of the access
token. The time period is represented using the <a href="http://php.net/manual/en/class.dateinterval.php">DateInterval</a>
format in PHP.  The default value is <code>P1D</code> (1 day).</p>
<p>The <code>refresh_token_expire</code> value is the TTL used for the refresh token. The
default value is 1 month.</p>
<p>The <code>auth_code_expire</code> value is the TTL of the authentication code, used in
the <a href="https://oauth2.thephpleague.com/authorization-server/auth-code-grant/">authorization code grant</a>
scenario. The default value is 10 minutes.</p>
<p>The <code>pdo</code> value is for the PDO database configuration. Here we need to insert
the parameters to access the OAuth2 database. These parameters are the <code>dsn</code>,
the <code>username</code>, and the <code>password</code>, if required. The SQL structure of this
database is stored in the <a href="https://github.com/zendframework/zend-expressive-authentication-oauth2/blob/master/data/oauth2.sql">data/oauth2.sql</a>
file.</p>
<p>If you already have a PDO service configured, you can instead pass the service
name to the <code>pdo</code> key as follows:</p>
<pre><code class="language-php">return [
    'pdo' =&gt; 'myServiceName',
];
</code></pre>

<p>The <code>grants</code> array is for enabling/disabling grants. By default, all the supported
grants are configured to be available. If you would like to disable any of the
supplied grants, change the value for the grant to <code>null</code>. Additionally,
you can extend this array to add your own custom grants.</p>
<h3>Configure Event Listeners</h3>
<ul>
<li><strong>Since 1.3.0</strong></li>
</ul>
<p><em>Optional</em> The <code>event_listeners</code> and <code>event_listener_providers</code> arrays may be used to enable event listeners for events published by <code>league\oauth2-server</code>. See the <a href="https://oauth2.thephpleague.com/authorization-server/events/">Authorization Server Domain Events documentation</a>. The possible event names can be found <a href="https://github.com/thephpleague/oauth2-server/blob/0b0b43d43342c0909b3b32fb7a09d502c368d2ec/src/RequestEvent.php#L17-L22">in <code>League\OAuth2\Server\RequestEvent</code></a>.</p>
<h4>Event Listeners</h4>
<p>The <code>event_listeners</code> key must contain an array of arrays. Each array element must contain at least 2 elements and may include a 3rd element. These roughly correspond to the arguments passed to <a href="https://github.com/thephpleague/event/blob/d2cc124cf9a3fab2bb4ff963307f60361ce4d119/src/ListenerAcceptorInterface.php#L43"><code>League\Event\ListenerAcceptorInterface::addListener()</code></a>. The first element must be a string -- either the <a href="https://event.thephpleague.com/2.0/listeners/wildcard/">wildcard (<code>*</code>)</a> or a <a href="https://event.thephpleague.com/2.0/events/named/">single event name</a>. The second element must be either a callable, a concrete instance of <code>League\Event\ListenerInterface</code>, or a string pointing to your listener service instance in the container. The third element is optional, and must be an integer if provided.</p>
<p>See the <a href="https://event.thephpleague.com/2.0/listeners/callables/">documentation for callable listeners</a>.</p>
<h4>Event Listener Providers</h4>
<p>The <code>event_listener_providers</code> key must contain an array. Each array element must contain either a concrete instance of <code>League\Event\ListenerProviderInterface</code> or a string pointing to your container service instance of a listener provider.</p>
<p>See the <a href="https://event.thephpleague.com/2.0/listeners/providers/">documentation for listener providers</a>.</p>
<p>Example config:</p>
<pre><code class="language-php">return [    
    'event_listeners' =&gt; [
        // using a container service
        [
            \League\OAuth2\Server\RequestEvent::CLIENT_AUTHENTICATION_FAILED,
            \My\Event\Listener\Service::class,
        ],
        // using a callable
        [
            \League\OAuth2\Server\RequestEvent::ACCESS_TOKEN_ISSUED,
            function (\League\OAuth2\Server\RequestEvent $event) {
                // do something
            },
        ],
    ],
    'event_listener_providers' =&gt; [
        \My\Event\ListenerProvider\Service::class,
    ],
];
</code></pre>

<h2 id="oauth2-database">OAuth2 Database</h2>
<p>You need to provide an OAuth2 database yourself, or generate a <a href="https://www.sqlite.org">SQLite</a>
database with the following command (using <code>sqlite3</code> for GNU/Linux):</p>
<pre><code class="language-bash">$ sqlite3 data/oauth2.sqlite &lt; vendor/zendframework/zend-expressive-authentication-oauth2/data/oauth2.sql
</code></pre>

<p>You can also create some testing values using the <code>data/oauth2_test.sql</code> file:</p>
<pre><code class="language-bash">$ sqlite3 data/oauth2.sqlite &lt; vendor/zendframework/zend-expressive-authentication-oauth2/data/oauth2_test.sql
</code></pre>

<p>These commands will insert the following testing values:</p>
<ul>
<li>a client <code>client_test</code> with secret <code>test</code>, used for <a href="../grant/client_credentials/">client_credentials</a>
  and the <a href="../grant/password/">password</a> grant type.</li>
<li>a client <code>client_test2</code> with secret <code>test</code>, used for <a href="../grant/auth_code/">authorization code</a>
  and <a href="../grant/implicit/">implicit</a> grant type.</li>
<li>a user <code>user_test</code> with password <code>test</code>.</li>
<li>a <code>test</code> scope.</li>
</ul>
<p>For security reason, the client <code>secret</code> and the user <code>password</code> are stored
using the <code>bcrypt</code> algorithm as used by the <a href="http://php.net/manual/en/function.password-hash.php">password_hash</a>
function.</p>
<h2 id="configure-oauth2-routes">Configure OAuth2 Routes</h2>
<p>As the final step, in order to use the OAuth2 server you need to configure the routes
for the <strong>token endpoint</strong> and <strong>authorization</strong>.</p>
<p>You can read how add the <strong>token endpoint</strong> and the <strong>authorization</strong> routes in
the <a href="../authorization-server/">Implement an authorization server</a> section.</p>




    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../..">
                    <i class="fa fa-chevron-left"></i> Previous
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../usage/">
                    Next <i class="fa fa-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>




    <div class="help-wanted">
        <p>
            Found a mistake or want to contribute to the documentation?
            <a href="https://github.com/zendframework/zend-expressive-authentication-oauth2/edit/master/docs/book/v1/intro.md" target="_blank" class="help-wanted__link">
                Edit this page on GitHub!
            </a>
        </p>
    </div>

                
            <!-- content:end -->
            </div>
            <div class="col-md-3 col-xs-12 sidebar">
                
                    <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../..">zend-expressive-authentication-oauth2</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item subnavigation__list-item--active">
                                <a href="./" class="subnavigation__link">Introduction</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../usage/" class="subnavigation__link">Usage</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../authorization-server/" class="subnavigation__link">Authorization server</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../authenticated-user/" class="subnavigation__link">Authenticated user</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item">
                                <span class="subnavigation__headline">Grant</span>
                                <ul class="subnavigation__list">
                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../grant/client_credentials/" class="subnavigation__link">Client credentials</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../grant/password/" class="subnavigation__link">Password</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../grant/auth_code/" class="subnavigation__link">Authorization code</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../grant/implicit/" class="subnavigation__link">Implicit</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../grant/refresh_token/" class="subnavigation__link">Refresh token</a>
    </li>

                                    
                                </ul>
                            </li>
                        
                    
                
            
        </ul>
    </div>

                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <h5>Zend Framework</h5>
                <ul>
                    <li><a href="https://framework.zend.com/">framework.zend.com</a></li>
                    <li><a href="https://docs.zendframework.com">docs.zendframework.com</a></li>
                    <li><a href="https://packages.zendframework.com">packages.zendframework.com</a></li>
                    <li><a href="https://apigility.org">apigility.org</a></li>
                    <li><a href="https://getexpressive.org/">getexpressive.org</a></li>
                </ul>
            </div>
        </div>

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">

            
            <div class="col-md-9">
                <h4 class="footer__headline">Copyright</h4>
                <p>&copy; 2006-2020 by <a href="https://www.zend.com/">Zend</a> by <a href="https://www.perforce.com/">Perforce</a>.</p>
            </div>

            
            <div class="col-md-3">
                <h4 class="footer__headline">Support</h4>
                <ul class="support__list">
                    <li class="support__list-item">
                        <a href="https://discourse.laminas.dev" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://laminas.dev/chat/" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://github.com/zendframework" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://twitter.com/zfdevteam" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

<nav class="cookie-bar navbar navbar-fixed-bottom navbar-default hidden">
    <div class="container">
        <p class="navbar-text">
            We use cookies to allow you to dismiss dialogs such as the Laminas
            Project notification.
        </p>
        <button type="button" class="cookie-button btn btn-default navbar-btn">Allow Cookies</button>
    </div>
</nav>

    <script>
        var base_url = '../..',
            siteName = 'zend-expressive-authentication-oauth2';
    </script>
    <script src="/js/scripts.js"></script>
    <script src="../../search/main.js"></script>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>



</body>


</html>
